<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4054b2">
  <title>Data APAR - QR Scanner</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="./css/styles.css">
  
  <!-- Library scanner -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="bi bi-fire"></i> MONOKEM SURYA
      </a>
    </div>
  </nav>

  <div class="container">
  
      <!-- Quick Stats -->
      <div class="row mb-0">
        <div class="col-4 col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <i class="bi bi-fire text-primary" style="font-size: 2rem;"></i>
              <h4 id="totalAparCount" class="mt-2">0</h4>
            </div>
          </div>
        </div>
        <div class="col-4 col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
              <h4 id="goodAparCount" class="mt-2">0</h4>
            </div>
          </div>
        </div>
        <div class="col-4 col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
              <h4 id="needRepairCount" class="mt-2">0</h4>
            </div>
          </div>
        </div>
      </div>
      
    <!-- Home Section -->
    <section id="home-section" class="section active">
      <!-- Scanner Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card scan-section">
            <div class="card-body text-center">
              <h5 class="card-title">
                <i class="bi bi-qr-code-scan"></i> Aplikasi Pengecekan APAR
              </h5>
              
              <div class="mb-3">
                <button id="startScan" class="btn btn-primary btn-lg me-2">
                  <i class="bi bi-qr-code-scan"></i> Mulai Scan
                </button>
                <button id="stopScan" class="btn btn-danger btn-lg" style="display:none;">
                  <i class="bi bi-stop-circle"></i> Stop Scan
                </button>
              </div>
              
              <div id="qr-reader" class="mb-3" style="display:none;"></div>
              <div id="resultBox"></div>
              
              <div class="mt-3">
                <small class="text-muted">
                  <i class="bi bi-info-circle"></i> Pastikan agar memberikan izin akses kamera ketika diminta
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Data APAR Section -->
    <section id="data-section" class="section">
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-table"></i> Data APAR
              </h5>
            </div>
            <div class="card-body">
              <!-- Loading Indicator -->
              <div id="dataLoading" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Memuat data APAR...</p>
              </div>
              
              <!-- Error Message -->
              <div id="dataError" class="alert alert-danger text-center" style="display: none;">
                <i class="bi bi-exclamation-triangle"></i> 
                <span id="errorMessage">Gagal memuat data APAR</span>
                <button id="retryLoadData" class="btn btn-sm btn-outline-danger ms-2">
                  <i class="bi bi-arrow-clockwise"></i> Coba Lagi
                </button>
              </div>
              
              <div class="table-container">
                  <table id="dataTable" class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Lokasi</th>
                        <th>Jenis</th>
                        <th>Kapasitas</th>
                        <th>Expired</th>
                        <th>QRCODE</th>
                        <th>Status Terakhir</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
                
                <!-- Empty State -->
                <div id="emptyData" class="text-center py-5" style="display: none;">
                  <i class="bi bi-inbox" style="font-size: 3rem; color: #6c757d;"></i>
                  <p class="mt-3 text-muted">Tidak ada data APAR tersedia</p>
                </div>
              </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Riwayat Pemeriksaan Section -->
    <section id="history-section" class="section">
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-clock-history"></i> Riwayat Pemeriksaan
              </h5>
            </div>
            <div class="card-body">
              <div id="historyList"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="bottom-nav-container">
      <a href="#home" class="bottom-nav-item active" data-section="home-section">
        <i class="bi bi-house bottom-nav-icon"></i>
      </a>
      <a href="#data" class="bottom-nav-item" data-section="data-section">
        <i class="bi bi-table bottom-nav-icon"></i>
      </a>
      <a href="#history" class="bottom-nav-item" data-section="history-section">
        <i class="bi bi-clock-history bottom-nav-icon"></i>
      </a>
    </div>
  </nav>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Modular ES6 JavaScript -->
  <script type="module" src="./js/app.js"></script>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-success">
            <i class="bi bi-check-circle"></i> Berhasil!
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Data pemeriksaan berhasil disimpan!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Inspection Modal -->
  <div class="modal fade" id="inspectionModal" tabindex="-1" aria-labelledby="inspectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="inspectionModalLabel">
            <i class="bi bi-clipboard-check"></i> Form Pemeriksaan APAR
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="inspectionForm">
            <!-- PERBAIKAN: Struktur row yang benar -->
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="inspectionDate" class="form-label">Tanggal Pemeriksaan:</label>
                <input type="date" class="form-control" id="inspectionDate" required>
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="expiredDate" class="form-label">Tanggal Expired:</label>
                <input type="date" class="form-control" id="expiredDate" required>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <label for="inspectorName" class="form-label">Nama Pemeriksa</label>
                <select class="form-select" id="inspectorName" required>
                  <option value="">Pilih Pemeriksa</option>
                  <option value="Gifary Setia Putra">Gifary Setia Putra</option>
                  <option value="Other">Lainnya</option>
                </select>
              </div>
            </div>

            <!-- Field input manual -->
            <div class="row mb-3" id="otherInspectorContainer" style="display: none;">
              <div class="col-12">
                <label for="otherInspector" class="form-label">Nama Pemeriksa (Manual)</label>
                <input type="text" class="form-control" id="otherInspector" placeholder="Masukkan nama pemeriksa">
              </div>
            </div>
            
            <!-- Form fields for inspection items -->
            <div class="card mb-3">
              <div class="card-header bg-light">
                <h6 class="mb-0">Kondisi Komponen APAR</h6>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Segel/Pin</label>
                      <div class="btn-group w-100" role="group" aria-label="Segel/Pin">
                        <input type="radio" class="btn-check" name="seal" id="sealBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="sealBaik">Terpasang</label>
                        
                        <input type="radio" class="btn-check" name="seal" id="sealTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="sealTidakBaik">Tidak Terpasang</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Handle/Tuas</label>
                      <div class="btn-group w-100" role="group" aria-label="Handle/Tuas">
                        <input type="radio" class="btn-check" name="handle" id="handleBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="handleBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="handle" id="handleTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="handleTidakBaik">Rusak</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Tabung</label>
                      <div class="btn-group w-100" role="group" aria-label="Tabung">
                        <input type="radio" class="btn-check" name="tank" id="tankBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="tankBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="tank" id="tankTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="tankTidakBaik">Berkarat/Rusak</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Label/Stiker</label>
                      <div class="btn-group w-100" role="group" aria-label="Label/Stiker">
                        <input type="radio" class="btn-check" name="label" id="labelBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="labelBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="label" id="labelTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="labelTidakBaik">Tidak Baik</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Selang/Hose</label>
                      <div class="btn-group w-100" role="group" aria-label="Selang/Hose">
                        <input type="radio" class="btn-check" name="hose" id="hoseBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="hoseBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="hose" id="hoseTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="hoseTidakBaik">Tidak Baik</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Nozzle/Corong</label>
                      <div class="btn-group w-100" role="group" aria-label="Nozzle/Corong">
                        <input type="radio" class="btn-check" name="nozzle" id="nozzleBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="nozzleBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="nozzle" id="nozzleTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="nozzleTidakBaik">Tidak Baik</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Manometer</label>
                      <div class="btn-group w-100" role="group" aria-label="Manometer">
                        <input type="radio" class="btn-check" name="gauge" id="gaugeBaik" value="baik" autocomplete="off">
                        <label class="btn btn-outline-success" for="gaugeBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="gauge" id="gaugeTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="gaugeTidakBaik">Tidak Baik</label>
                        
                        <input type="radio" class="btn-check" name="gauge" id="gaugeTidakAda" value="tidak-ada" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="gaugeTidakAda">Tidak Ada</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="form-group">
                      <label class="form-label">Bracket/Dudukan</label>
                      <div class="btn-group w-100" role="group" aria-label="Bracket/Dudukan">
                        <input type="radio" class="btn-check" name="bracket" id="bracketBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="bracketBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="bracket" id="bracketTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="bracketTidakBaik">Tidak Baik</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-12 mb-3">
                    <div class="form-group">
                      <label class="form-label">Rambu/Tanda</label>
                      <div class="btn-group w-100" role="group" aria-label="Rambu/Tanda">
                        <input type="radio" class="btn-check" name="sign" id="signBaik" value="baik" autocomplete="off" required>
                        <label class="btn btn-outline-success" for="signBaik">Baik</label>
                        
                        <input type="radio" class="btn-check" name="sign" id="signTidakBaik" value="tidak-baik" autocomplete="off">
                        <label class="btn btn-outline-danger" for="signTidakBaik">Tidak Baik</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="notes" class="form-label">Keterangan Tambahan</label>
              <textarea class="form-control" id="notes" rows="3" placeholder="Masukkan keterangan tambahan jika ada"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> Batal
          </button>
          <button type="submit" form="inspectionForm" class="btn btn-primary">
            <span id="submitText">
              <i class="bi bi-check-circle"></i> Simpan Pemeriksaan
            </span>
            <span id="submitSpinner" class="spinner-border spinner-border-sm" style="display:none;"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>